#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void show(unsigned univ[])
{
	int w = 30, h = 30;

	printf("\033[H");
	
	for(int i = 0; i < h; i++){
		for(int j = 0; j < w; j++)
			printf(univ[(i * h) + j] ? "\033[07m  \033[m" : "  ");

		printf("\033[E");
	}

	fflush(stdout);
}

void evolve(unsigned univ[], unsigned new[])
{
	register int sum_y = 0;
	register int x, y;
	register int w = 30, h = 30;

	for(y = 0; y < h; y++) {
		for(x = 0; x < w; x++)
		{
			register int n = 0;
			register int y1; 
			for (y1 = y -1; y1 <= y + 1; y1++)
			{
				register int sum = 0;
				register int mod_y;
				register int i;

				if(y1 < 0)
					mod_y = y1 + h;
				else if(y1 == h)
					mod_y = 0;
				else
					mod_y = y1;

				for(i = 0; i < mod_y; i++)
					sum += h;

				for (i = x -1; i <= x + 1; i++)
				{
					register int mod_x;
					if(i < 0)
						mod_x = i + w;
					else if(i == w)
						mod_x = 0;
					else
						mod_x = i;

					register int sum_ = sum + mod_x;

					if (univ[sum_])
						n++;
				}
			}

			register int pos = sum_y + x;
			if (univ[pos]) 
				n--;
			
			new[pos] = (n == 3 || (n == 2 && univ[pos]));
		}

		sum_y += h;
	}

	sum_y = 0;
	for(y = 0; y < h; y++)
	{
		for(x = 0; x < w; x++)
			univ[sum_y + x] = new[sum_y + x];

		sum_y += h;
	}
}

int main()
{

	unsigned new[900];
	unsigned univ[900] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,1,
                          0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,
                          0,0,1,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,
                          0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
                          0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,
                          0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,
                          0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
						  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,1,
                          0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,
                          0,0,1,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,
                          0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
                          0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,
                          0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,
                          0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
						  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,1,
                          0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,
                          0,0,1,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,
                          0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
                          0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,
                          0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,
                          0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};



	register int i = 0;
	for(; i < 900; i++)
	{
		unsigned short lfsr = 0xACE1u;
		unsigned period = 0;
			
		// do {
		// 	/* taps: 32 31 29 1; characteristic polynomial: x^32 + x^31 + x^29 + x + 1 */
		// 	lfsr = (lfsr >> 1) ^ (unsigned int)(0 - (lfsr & 1u) & 0xd0000001u); 
		// 	++period;
		// } while(lfsr != 1u);

		new[i] = 0;	
		//univ[i] = lfsr;
	}
	
	i = 0;

	while (i != 100000) {
		evolve(univ, new);
		show(univ);
		usleep(20000);
		i++;
	}

	printf("------FINISH------\n");
}